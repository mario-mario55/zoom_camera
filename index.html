let frontCameras = [];
let backCameras = [];
let currentCameraType = 'front'; // 'front' or 'back'

async function getVideoDevices() {
  const devices = await navigator.mediaDevices.enumerateDevices();
  const videoInputs = devices.filter(d => d.kind === 'videoinput');
  frontCameras = [];
  backCameras = [];
  videoInputs.forEach(device => {
    const label = device.label.toLowerCase();
    if(label.includes('front') || label.includes('内') || label.includes('face')) {
      frontCameras.push(device);
    } else if(label.includes('back') || label.includes('rear') || label.includes('環境') || label.includes('wide')) {
      backCameras.push(device);
    } else {
      // どちらにも分類できなければとりあえず back に入れておく
      backCameras.push(device);
    }
  });
  console.log('内カメラ:', frontCameras);
  console.log('外カメラ:', backCameras);
}

async function setupCameraByType(type) {
  let deviceList = (type === 'front') ? frontCameras : backCameras;
  if(deviceList.length === 0) {
    // そのタイプのカメラがない場合はもう一方を使う
    deviceList = (type === 'front') ? backCameras : frontCameras;
  }
  if(deviceList.length === 0) {
    alert('カメラが見つかりません');
    return;
  }
  // ここでは単純に最初のカメラを使う
  await setupCamera(deviceList[0].deviceId);
  currentCameraType = type;
  console.log(`現在のカメラ: ${type}`);
}

switchBtn.addEventListener('click', async () => {
  if(frontCameras.length === 0 && backCameras.length === 0) {
    console.log('カメラがありません');
    return;
  }
  if(currentCameraType === 'front') {
    await setupCameraByType('back');
  } else {
    await setupCameraByType('front');
  }
});
